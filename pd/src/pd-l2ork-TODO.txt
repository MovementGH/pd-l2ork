PD-L2ORK TODO:
*Seek RPi version of nw.js 0.67.1. IN PROGRESS

*Finish integration of packages necessary for a successful compiling of the Windows version of pd-l2ork into README.md.

*Add documentation for second inlet of the K12/output object inside its help file META subpatch.

RARE:
  *Selecting and displacing an array within a GOP doubly displaces its array data.
  *Putting bar graph and then editing it displaces its data.

*Update portaudio for OSX and re-check if it is ok for all platforms.

*Figure out the OSX Big Sur issue that the user does not have a permission to run the application.
  *Appears to be related to opening the program from multiple accounts.

*Consider porting AG version of cyclone editor (what are the differences?).

*Investigate ggee/image redraw of the entire canvas.
  *This is due to undo_cut redrawing canvas to reposition all objects where they belong. Added TODO inside g_editor.c where repositioning inside DOM should take place.
    *Need to figure out logic how to do this reliably. Probably by referencing the tag of the object right below it (or above it, whichever is easier) and placing it there.
      *How to deal with selection of multiple objects, however?
        *Perhaps this should be tackled during pasting action (per object, if possible), not after the fact?
          *Is this worth the effort just to offset the flicker of images loading inside K12 objects? Or, could this be handled inside the image object instead?

*Add translations for the K12 menu tooltips.

*Add canvas options for nomenu, background color, draw border, and ontop (if it works in nw.js). Test noscroll option.
  *Also add resizable (to prevent resizing of the canvas in K12 mode and other more controlled applications).

*Port vanilla garray set colors (we already have this, so check if the two are compatible), line width, visibility, display style (is this something other than the type of graph?), and disable mouse editing (disabling mouse editing is URGENT for the forgotten planet module).
  *Make sure that if an array is not editable, that is passes along its mouse interaction to objects below.

*Consider implementing verbose option from vanilla.

*Implement object tooltips.

*Test nwjs 0.67.1 for regressions:
  *Patch window positioning: loading saved one (offset issues), and scripted ones (e.g. spectrogram inside pitch relationships patch).
  *Opening and closing window via a script does not reopen the window in the same place nor with the same size. Same is true for saving a patch and reopening it. Affects Linux running nw.js 0.28.1. Need to test with the latest nw.js.
    *Investigate index.js' nw_create_window, and the pdgui.js' canvas_check_geometry.
    *Also use index.js console positioning aspect, if necessary.
    *UPDATE: scripted repetitive vis/unvis window in pitch_relationships patch makes the window open further down (but not always) and makes the window bigger.
    *Clean-up all the other offsets found throughout the code (e.g. window_offset, which does not appear to affect the setbounds call).

*Port:
  *cyclone
    *mousestate
    *mousefilter
    *active
    *comment
    *prob
  *tof
    *breakpoints
    *breakpoints~
    *folderpanel
    *menubutton
    *pmenu
  *vanilla
    *openpanel?
    *new patch offset (Every "new" window is a bit shifted so it does not appear perfectly superimposed)
    *listbox gatom
    *file
    *force close pd instance to ensure there are no stray ones left? (sounds potentially counterproductive given we also have -unique flag)

*Pick the best nw.js (==> denotes the current choice)
  *Current status:
    0.28.1 next/prev option does not work.
    0.28.3 next/prev option does not work.
RPI 0.28.4 current RPi version.
    0.40.2 next/prev option does not work.
    0.41.3 next/prev option does not work.
    0.42.3 next/prev option does not work. on a dark theme in Linux menu items are not visible.
    0.42.4 register_window_id not found error. does not display anything. everything from here below has CMD+(1-9) broken on OSX when keeping the nw2 option enabled.
    0.42.5 register_window_id not found error.
    0.42.6 register_window_id not found error.
    0.43.0 register_window_id not found error.
    0.43.1 register_window_id not found error.
    0.43.2 register_window_id not found error.
    0.43.3 register_window_id not found error.
    0.43.4 register_window_id not found error.
    0.43.5 segfaults on Linux when opening dev tools.
    0.43.6 segfaults on Linux when opening dev tools.
    0.44.0
    0.44.6 everything from here works with next/prev window and Pd window options.
    0.54.0
    0.56.0
    0.58.0
    0.59.1
    0.60.0 everything form here below also has incorrectly placed windows when using nw2 option.
    0.60.1 everything above this ocassionally crashes on OSX due to lack of a fix introduced in 0.60.1
    0.62.1
    0.62.2
    0.63.1 crashes on Linux.
==> 0.67.1 
    0.68.0 window close nw1 bug (see #7981 nwjs bug report).
    0.69.1 window close nw1 bug (see #7981 nwjs bug report).
    0.70.1 window close nw1 bug (see #7981 nwjs bug report).
  *Need to figure out what is slowing down nw2 on versions 0.42.3 and onward, so that we can get away from all the weird idiosyncrasies with window positioning and other issues.

*Ubuntu 22.04 build: investigate iem16 build issues and gmerlin library support. 20.04 uses 1.16 automake and 2.69 autoconf. 22.04 uses 2.71 autoconf and ??? automake.

*HDMI audio output support (RPi).

*Submit patch to js external github.

*Consider adding ability to display array name that is other than the internal name (e.g. so that we don't have to use $0, $1, _ etc. in the name).

*Error closing a new window because there is no "width" property (e.g. a subpatch has been created). Only affects RPi version of nw.js? Consider bumping the RPi nw.js version...

*Consider adding tiled version of an image inside ggee/image.

*refine window heights for various dialogs, so that they always display fully on-screen. UPDATE: check if this has been fixed using latest nw.js (affects only Windows).

*port shell object to Windows?

*add bezier curve drawing ability to the arrays (currently displaying them as polygons).

*fix inefficiency of the profuse console output.

*Fix build system inconsistencies.
  *Make incremental on a Mac results in a broken build that does not include Gem.
  *Repair light build on OSX. Test it on other platforms.
  *UPDATE: should we disable light builds altogether now that K12 mode is baked into the core?

*Investigate if patchwin array is kept properly up-to-date. Got window error when one creates a window, toggles its k12_menu, then creates another one and closes the original one and tries again. Suspect that going through the array trips up across the previously closed window. Currently, have a stopgap check if patchwin is not null before invoking its pd_canvas.js onchange.

*think about a way to deterministically inform both front-end and the back-end that the canvas has indeed loaded. See https://stackoverflow.com/questions/4057236/how-to-add-onload-event-to-a-div-element/55106785#58838457 (Third Attempt (and Definitive Solution))


RARE:
*An error in OSX preferences when working with GUI dropdown (or something along those lines).
  *Figure out how to reproduce.

*sometimes closing a newly created window before it has posted or possibly creating two windows by quickly double clicking on a subpatch irreversibly breaks the front-end. Need the better checks'n'balances.

*occasionally when editing a new object text is not displaying until you click outside it. happened with the modulo object.

*check for stray/sporadic bug where bang and other objects stop working and bang object gets stuck in on mode until the mouse is moved (nw.js bug? UPDATE: it appears at least one of the sources was a bug in the scroll_to_gobj call that was fixed on 2021-11-01).

*Sometimes editing message resizes the object size without erasing text. Is this a nw.js bug?

*Textbox still sometimes loses all its text (get a console error resizebytes being out of memory).

*Space in path (e.g. username) makes installing apps in the user folder fail.
  *Tested and cannot reproduce. Looks like a permissions issue, perhaps?


MAYBE:
*gui_canvas_scroll_to_gobj should only scroll to an object if doing so improves situation (e.g. if the object is wider than the screen, then scrolling won't fix anything)?

*add ability to custom name each instance of pd-l2ork (pd~?).

*Consider adding smooth scroll to the scroll action. NO--could end up too CPU intensive and not worth it until engine and front-end are fully decoupled.


PD-L2ORK DONE:
*Add focus/commit to numbox2
*Add output option whenever an arrow up/down is pressed on the numbox2 while it is activated (with or without shift)
*Add interactive flag to gatoms and all iemguis that can be interacted with (gatom, tgl, bng, number2, vslider, hslider, vradio, hradio, knob, mknob)
*Gatoms need to be interactive by default
*Fix weird coloring of the mknob
*Update help files
*gatom when edited from larger length to smaller, ends up having garbage (e.g. one that has 3 chars or numbers, activate it, and then start typing--after first char you end-up having garbage there) ONLY APPLIES TO THE 0 width gatoms (both text and number ones)
*"sorry, I could not find the source of that error" should be message if it is a message and not an error
*clicking on find box and then onto the canvas makes canvs interpret it as a selection box
*pressing return with the find bar open after you've already found an item and with the item deselected, does not reinitiate search
*search unable to find a phrase embedded inside another word (e.g. $1-local-$5-blah will not be found when searching for $5)
*Fixed netserver's extraneous benign errors: netserver: Resource temporarily unavailable (11) and netserver: could not send data to the client (including a typo)
*object width that is wider than text width due to the number of nlets when being edited does not size itself properly
*add copy option to gatoms (add the gatom value to the clipboard)
*Revamped the search box fixing bugs, regressions, and adding missing features.
  *Fixed HTML bug in pd_canvas.html
  *Added ability to properly detect wholeword vs partial word search
  *Ensured that when clicking on the find bar the click does not propagate onto the canvas, which could cause erroneous selection boxes and other issues.
  *Made sure that the existing selection box upon invoking the find bar is properly handled with a fake mouseup event.
  *Ensured that when one changes whole word option or deselects last found object, the search process restarts from the beginning.
  *Made it possible to search for A_DOLLAR inside an A_DOLLSYM (e.g. searching for $3 inside blah-$3-something would erroneously yield no results).
*More stability improvements to the maxlib/netserver.
  *Fixed extraneous benign errors due to the use of the new non-blocking mode. Made default debug output more conservative.
*fixed activated text box size and side-stepped the cord update issue, updated close dialog animation.
  *When text box is activated and the number of inlets or outlets requires that the object be wider than its text or specified width, the object now specifies appropriate width.
  *During editing because updating cords is not currently easy to do given that this logic is now spread across both nw.js and C, the edited object now has an aura (achieved through CSS) that ensures that the cords at least appear to fade out into nothing during the editing process, until the object is deactivated, at which point the C code will update cord locations.
  *Closing dialog is now animated and makes the visual experience a bit "smoother".
*add click mode 3 for the ggee/image that allows for tracking the cursor whithout preventing the passing of the click to objects below.
  *Updated core pd-l2ork engine behavior to allow for passing of pointer behavior to passthrough objects even if
   an object is grabbed.
  *Ensured proper stacking order (top to bottom).
  *Updated dialog and help files.
*Fixed a bug where opening recent image-help.pd file inside an instance of pd-l2ork spawned f
rom a command line, causes error when trying to open the image file associated with the image obje
ct because of nw.js' inability to handle relative paths provided by the pd-l2ork engine.
*Cosmetic fixes to help files
*Fixed bug where select all inside the dialogs (when selecting a text or numbers) on OSX selects canvas objects instead. Added ctrl/cmd+w for closing all dialogs that bind to the pdgui.dialog_bindings(windowname). Added ctrl/cmd+a for selecting text and numbers only on all dialogs that bind to the same call.
*Major regression: passthrough is not mapping properly inside GOP.
  * Required changes to the ggee/image and the core behavior inside g_editor.c and g_graph.c
  * Passthrough mode did not work after an object inside GOP has been grabbed.
  * x were y are off inside GOP.
  * Checked the mouseup event.
*Fixed regression on how the activated objects behave on the right edge and other object resizing logic.  
  * Added logic for providing nw.js with the activated object's number of nlets, which will help determine whether the object should automatically resize its width based on the text width (objects with more than 2 inlets or outlets will need to remain the same size, so as not to introduce dangling patchcords, since we have no way to update patchcord position until the object has been deactivated).
  * Fixed regression how the objects did not resize properly due to addition of the pixel-based width for an object to ensure the object with more than 1 in/outlet keeps its width.
  * Ensured that objects on the right edge do not get activated with more lines than they have deactivated (linked to problems above).
*Vastly improved performance using the new passthrough mode. Changed how the passthrough mode 3 communicates mouse events.
*Updated image help file and its dialog to reflect changes in image behavior.
*Updated the install README.
*Fixed a long-standing pd bug where resizing a text object whose x1 and y1 overlap with another one above it results in the wrong object being resized.
*Fixed a long-standing bug where trying to connect an object whose outlet we wish to connect from is partially covered by another object which has no outlets (e.g. comment), even though the connection cord is initially created, it does not want to connect to other objects (inlets are not highlighted and upon releasing the mouse button, the connection never happens). This is because previous logic relied on canvas_findhitbox which is not checking whether objects have nlets, so it returns topmost object, rather than the topmost one with outlets (which is the one we started connecting from).
*Fixed a bug where scroll_to_gobj (e.g. when using "find" feature) would be called before a new window is properly registered, and, as a result it would trigger a js error. Now, it waits until the window is properly registered.
*Fixed a bug where calling "find again" in a subpatch that was opened by a "find again" request, gives wrong result. Further refined the previous bug-fix.
*Reworked the find logic when searched across multiple windows and with multiple search bars open. Whenever search reaches a subpatch with an open search bar, it closes it to minimize confusion. Find again always goes back to the current search scope (toplevel patch) and search word until user clicks on a search button in any find bar (at which point that becomes the toplevel patch with its search text.
*Added highlight for gatoms when being edited directly by user (when pressing enter).
*Added highlight for numbox2 when being edited directly by user (when pressing enter).
*It appears on Ubuntu 20.04, large windows get automatically maximized. This adversely affects Tweeter appearance. The only way to fix this is to adjust Ubuntu settings by typing "gsettings set org.gnome.mutter auto-maximize false". Later, we will look into adding "maximizable" and other options from 1.x and beyond to the window management.
*Fixed a bug where mycanvas dialog says image width instead of rectangle width. Fixed co-dependence of the dialog_image and dialog_iemgui and added missing translation entries for fr and de translations.
*Fixed weird message resizing issue that causes text inside to be partially invisible and to scroll.
*Fixed a regression where sometimes copying stops working, triggering the following error: TypeError: Cannot read property 'classlist' of undefined.
*Fixed the defunct moonlib/image external. Marked it as loudly as possible as defunct.
  *selection rectangle is off.
  *clicks still register in GOP patches (likely core fix).
  *border highlights inside GOP patches.
  *error reopening a patch once it has been saved and closed (works fine on first try--likely path issue).
  *weird repositioning and visibility issues inside GOP.
  *size should automatically readjust.
*Fixed memory leaks with moonlib/image.
*Implemented batch image loading for ggee/image, so that it can handle image sequence (akin to moonlib/image).
*Updated ggee/image and moonlib/image help files accordingly.
*Overhauled tof/imagebang to work in Pd-L2Ork. Updated help file and removed questionable help file content.
*Updated moonlib/image and tof/imagebang to consistently support both relative and absolute paths of images.
*Updated moonlib/image to address the bug where opening an image after setting a preloaded one did not immediately update the image. Further refinements to the help file.
*Fixed regressions where images did not display properly (or at all) on Windows. Removed flicker on moonlib/image. Updated help files for tof/imagebang and moonlib/image.
*Removed unnecessary error message from the ggee/image.
*Improved all dialogs that have dynamic updating of fields to ignore calls while the window is still being created.
*Refined delayed scroll during find (when a subpatch needs to be opened), so that it checks when the window is ready. Improved scrolling logic for windows whose leftmost and topmost coordinate may be negative.
*Added dynamic field updating for the gatom dialog for interactive and exclusive options.
*Added to all the various core iemgui object options ability to autoupdate fields inside their dialogs (if any). Exposed numbox' drawstyle and autoupdate as a patching message. Additions to help files and cosmetic fixes.
*Fixed size redrawing bug in the moonlib/mknob and ensured that its values also autoupdate when the dialog is open.
*Minor cosmetic refinements to deprecated objects.
*Improvements to the flatgui/knob, including width for the dial, off and on segments of the dial circle, automation of the dialog fields (when open), additional translation options for the new fields, and other minor bug-fixes.
*Updated miXed/cyclone to support all the file i/o features (e.g. coll object) replacing non-functioning legacy calls. Fixed a bug in coll object where it did not report all load/save calls via its 3rd outlet.
*Improved keyboard shortcuts for the text editor widget (used by "text define" and various cyclone library objects, such as coll).
*Fixed regression in scroll_to_gobj that is triggered when doing find/findagain request and which could trigger an error due to window not having been created yet, breaking the UI.
*Vastly improved find/find again behavior that now detects also matches in object's sends and receives.
*Removed leftover debugging printout message in find_ignore and legacy warning for the color saving format for the iemgui objects.
*Deal with array manipulation and data structure drawing location issues.
  *fixed being unable to click on arrays both within GOP and toplevel, including having multiple arrays and the ability to click either of them. Note that when an array has jump-on-click (joc) enabled, it will override any clickable array since it takes entire size of the array window.
  *changed the cursor appearance when manipulating arrays.
  *toplevel window with an array should not have any scrollbars.
  *fixed a bug where array_joc did not get updated when invoked from the toplevel window array properties.
  *scalar subpatch does not update appearance when the patch window is resized.
  *scalar selection box in a subpatch (see disis_wiimote-help.pd subpatch with 4 blobs) is inacurate and larger on the left side as you move the scalar further to the right.
*When opening a GOP-enabled patch whose gop rectangle should not be drawn because subpatch has only scalars, you can still resize the parent GOP size (cursor changes to resize arrows).
*Fixed a bug where comments exceeding 1024 characters got malformed when being sent to the engine.
*Fixed helplink not being able to revert to its reformatted text after being activated. Updated pddplink to use the new method to avoid it being redrawn in a wrong z order from the other objects on canvas.
*Receive is now reconfigurable, just like the send object, when its scope is empty (or equal to &s_). updated supporting help file.
*Fixed a bug where large text boxes with line break on a hyphen spilled over the box boundaries (originally detected in the filter-remote-admin-messages in the L2Ork-Tweeter-Server).
*Added ability for the netserver object to disconnect clients based on their socket number, updated and improved both netserver and netclient help files.
*Reworked pasting of patch content (copyfromexternalbuffer) directly into the patch to ensure that optional width info (provided as , f <width>;) is reformatted as a new line #X f <width>; and previous line terminated by a ;.
*Further adjustments to the copyfromexternalbuffer to address idiosyncrasies of Windows.
*Revised and finished context help patch dealing with $0, $1, and $2 (all_about_scope_and_locality.pd).
*Array editing cursor should revert to regular cursor upon right-click (and revert afterwards).
*Fixed Gem not building properly on newer msys2 installs.
*Finished renaming the remaining instances of purr-data to minimize confusion between the two releases.
*Fixed a bug where searching for an expression also incorrectly highlighted a canvas containing such an object even if the canvas did not have the expression in its name (e.g. searching for $1-overdrive inside L2OrkTweet.pd version 0.63 incorrectly highlights subpatch containing the expression).
*Made redrawing of canvases after changing option for curved cords more robust, avoiding redundant redraws. Fixes errors printed to the console.
*Fixed a bug where the hand grabbing cursor during connecting reverted back to cursor_editmode_nothing as soon as the mouse moved after initiating the connecting action by clicking on the outlet.
*Fixed a bug where netserver was not correctly freeing disconnected clients and updating the number of clients.
*Added option for netserver to adjust the threshold for the number of failed packets sends before disconnecting the user server-side. This is typically used when a client disconnects in a way that does not give the netserver opportunity to receive disconnection notice.
*Fixed a crasher with netserver due to static use of inbinbuf which causes netserver to crash when running two instances with no creation argument. By default implicit port of 0 successfully instantiates the object. However, the object is not functional.
*Removed the threshold option on the netserver as it resulted in a faulty number of clients reported and unintentional disconnections.
*Updated the build script for sensel and pdjs externals, so that they also work on arm processors (e.g. RPi).
*Updated nw.js on all platforms to 0.28.
*Cosmetic fixes to the sensel external and its README.md.
*Updated Linux deb prerequisites.
*Fixed a bug where Windows sensel external did not work out-of-box.
*Fixed a bug where curved_cords option could not be re-applied until the preferences were reopened.
*Added missing translations for german and french for the General tab in the Preferences window.
*Updated fluid~ external to safeguard against loading files other than sf2, updated its documentation to reflect this, added default soundfont to ensure K12/midi_synth can always have a soundfont available, and updated K12/midi_synth accordingly.
*Fixed bug with array define if one clicks to view the array. This would trigger following errors:
error: array: no method for 'query-editmode'
error: array: no method for 'updatemenu'
error: array: no method for 'mouseup_fake'
error: array: no method for 'magicglass'
*Adjusted vertical position of the X axis labels on the arrays (on by default using array define), so they don't overlap with the array's border.
*Made edit menu automatically toggle options that are applicable to a particular patch. Useful for patches that are not editable (e.g. array window or the "array define" canvas).
*Explored issue with poke~ and the following error warning: extern using garray_getfloatarray() won't work in 64-bit version. UPDATE: This is not an issue but only a warning. It appears not to affect poke~ object. The poke~ documentation has been updated to include information about the bang signal that is meant to request array redraw since the object does not do so manually (as doing so would result in redraw requests on per-sample change and therefore unreasonable CPU overhead).
*Implemened snap to grid option and reworked how the editmode is visually altered when holding the ALT button.
*Updated links to Pd-L2Ork apps to point to the user folder instances, so that they are immediately modifiable, as needed.
*Minor fixes to the Audio-Chat app.
*Initial port of the autocomplete feature (next TODO commit will highlightchanges that still need to be addressed).
*Fixed regression with the merging of the autocomplete patches (canvas properties could not open due to an error).
*Improved dac~ and adc~ help symbols, so that they are properly shown in the autocoplete (was adc~_dac~).
*When closing a gop subwindow, the parent patch should be redrawn to honor ordering of the objects. This is a temporary fix until the proper GOP drawing is implemented.
*A temporary fix for the issue where objects keep redrawing/flickering when using tabwrite and repositioning the GOP array that is visible inside the same patch while in edit mode and with another GOP object being selected (notably K12 object). Up until now, the repositioning was erroneously done on the selected object, rather than the array. Now, the repositioning request uses the tag of the array object and repositions it correctly. This workaround will be removed when the proper GOP drawing is implemented.
*Added external editor to js object for Linux and OSX. Updated js object help file to reflect changes.
*Fixed array put and canvas properties dialogs to accomodate child color picker window.
*Updated js help file to provide additional clarification regarding the compile message.
*Fixed regression on OSX where reopening saved patch resulted in 22px taller patch window than what it was when saved. Bumped installer for non-RPi OSs to 67.1.
*Further refined the js-help.pd file.
*Updated libFLAC linking in the Makefile for the Windows platform due to changed library name.
*Fixed regression where UDP packets were not being sent. This is a legacy object and likely not to be developed further. Small cosmetic changes to the supporting help files.
*Fixed slight visual regression on the Raspberry Pi externals in the K12 library. On image was being drawn over all other GUI elements.
*Cosmetic fix to a documentation patch.
*Improved compiling from source instructions for Linux platform.
*Fixed array put and canvas properties dialogs to accomodate child color picker window.
*Reworking GOP drawing order to allow for partial visibility.
  *Initial commit that enables all iemgui, gatom, comment, and dropdown, as well as gop canvas objects to be drawn as children of the GOP patch they belong to.
  *Fixed ggee/image and flatgui/knob to work with the new GOP drawing approach.
  *Ported pddplink to the new GOP drawing logic. Enabled GOP visiblity of the pddplink (thus forgoing the documentation of the currently undocumented -gop flag, while maintaining backwards compatibility), and fixed two bugs associated with the pddplink drawing.
  *Fixed moonlib mknob and image objects to support new GOP drawing order.
  *Updated Scope~ to work with the new GOP drawing order.
  *Fixed inconsistency inside graph_vis. Needs to be further tested.
  *Fixed Scope~ object not highlighting properly when selected (and not highlighting inside a GOP subpatch even when the GOP is selected, as it should).
  *Updated pianoroll to work with the new GOP drawing. Updated the external dialog to better accommodate its parameters.
  *Pianoroll now gets properly highlighted when selected (only when toplevel)
  *Additional fix for pianoroll (forgot annother gui_gobj_new call)
  *Fixed the way pianoroll is drawn (removed redundant border), made its selection box wider to make it easier to spot.
  *Fixed image object showing through GOP window when the GOP patch is selected and when all inside objects should not be visible.
  *Updated grid object, correcting a number of bugs, including point being visible when the GOP is selected, and autoupdating of the point location when the grid is resized.
  *Refined selection box for the grid object.
  *Ported room_sim_2d and room_sim_3d to the new GOP drawing method. Made selection outline properly colored and more easily visible.
  *Added support for arrays (inside GOP or toplevel). Additional debugging commands (while working on other types of scalars).
  *Bugfix for GOP array drawing, accounting for issues associated with creation, and for changing of array properties. This one should be universal and much better than previous approaches.
  *Reenabled proper coloring of dirty abstractions (GOP and non-GOP).
  *Fixed a bug where patches with non-array scalars were not editable.
  *Fixed non-array scalars being displayed incorrectly both on toplevel and inside a GOP subpatch.
  *Made sure that subpatches are not marked dirty when displayed or manipulated, only the abstractions.
  *Ported scalars to work with the new GOP drawing approach. Fixed a long-standing bug with scalars not having correct selection box.
  *Removed redundant selection inside a toplevel array after applying new properties. This should not happen because the array window should not be editable.
  *Fixed a bug where array is slightly offset downwards inside a toplevel window after applying new properties.
  *Fixed regression where fake keyup was not registered anymore on canvasobj (see pd_canvas.js' target_is_canvasobj).
  *Fixed GOP subpatch/abstraction titles to be located under the objects for legacy purposes. This only affects GOP enabled patches on their parent canvases. Other text (including arrays) is always on top, which makes more sense for readabaility purposes. LATER consider making this a legacy flag option. The benefit of keeping it this way is so one can continue to use such patches without hide text which should be reserved for K12 objects, for instance, to prevent their editability and potential new user confusion with the complex object appearance and its potential breakage due to a typo/insertion/deletion. On the other hand, keeping text visible, yet covered by another object, enables its visibility when a user wants to edit things (e.g. L2Ork-Tweeter parts). Otherwise, it is invisible.
*Fixed disis_gpio external and updated build script to accommodate changes.
*Fix OSX build on Xcode 14.
*Add new accelerated version of Gem to OSX.
*Fixed OSX code signing and mic and camera permissions on Catalina and newer.
*Improved deb dependencies.
*Fixed dropdown menu offset due to new GOP drawing implementation (only affected menu belonging to a dropdown two or more levels deep).
*Fixed regression where deselect single GOP patch deselected all of them.
*Fixed highlighting of message and number2 objects using newly implemented GOP drawing approach.
*Fixed incorrect drawing of GOP objects when placed in a negative X or Y location on canvas.
*Improvements in handling OSX menu bar.
*Fixed positioning of the data structures inside a GOP (e.g. nunchuk joystick crosshair inside disis_wiimote-help.pd). Ensured that scalars properly adjust position and drawing aspect ratio based on the GOP window resizing and how they are drawn 2 levels deep inside a GOP (GOP inside a GOP).
*Fixed positioning of the dropdown for autocomplete in a patch that has top-left corner with negative coordinates. Made the autocomplete scrollable (rather than fixed to the position relative to the viewport). Both new_obj_textarea and autocomplete are placed below the scrollbars.
*Made autocomplete switch above the object if it does not fit into the window (like dropdown), but only if it can fit above. Otherwise, we leave it below.
*Fixed buggy coloring of the abstraction outline when dirty (or subdirty).
*Reenabled autopatching while typing an object name.
*Reworked dependencies for Linux to support Ubuntu 22.04.
*Updated Linux and Windows build to use latest nw.js.
*Updated the RPi build to use the closest version to that of the desktop (0.40.3 for RPi and 0.42.3 for desktop).
*Fixed regression where cut/copy/paste/select all did not work inside edited text boxes.
*Fixed the regression where array on a parent patch that was also a GOP subpatch did not get displayed properly. Turns out legacy repositioning code that wasn't removed was the culprit. This also vastly simplifies the garray drawing.
*Made scalars without a template a visible/selectable/movabel/deletable square, as is the case with vanilla.
*Ported and improved ggee/envgen external. This one is marked legacy and is currently not being developed further. May revisit this later by enabling visual resizing and deleting of objects.
*More envgen improvements to the envgen documentation and a bugfix in sustain/release implementation.
*Ported imagebang to the new drawing logic.
*Ported helplink to the new drawing logic.
*Added main Gem library git submodule with latest updates and updated build scripts for OSX and Windows and tested that it works on Linux, as well.
*Added option on the general preferences tab for when nw.js is downgraded to delete the nw.js user data folder.
*Updated K12 Rpi GPIO abstractions to avoid unnecessary console output and potential errors opening GPIOs due to bad timing.
*Merged latest autcomplete improvements in Purr-Data with additional bug-fixes.
*Fixed OSX having inconsistent positioning of the new patches (file->new) likely due to a bug in nw.js 0.28.3. See comment in the code on how to handle this later with future nw.js upgrades and the introduction of the saving of the Pd-L2Ork console position and size.
*Implement gopspill option for the canvases.
*Fix the major slowdown with nw.js versions newer than 0.42.3.
*Update K12 objects to use gopspill option, so that the icons are not truncated.
*Update autocomplete box appearance and wording inside the preferences (more space above, remove "experimental" wording).
*Enabled rebuilding of the index on every startup if build_index option is set in the preferences. LATER: investigate how the timestamp feature works...
*Ensured that the gopspill option does not work for arrays (via dialog or scripting).
*A number of improvements to the autocomplete:
  *Do not index (for autocomplete purposes) object name and/or args that failed to create.
  *Improved mechanism for autocompletion text removal (using ctrl+y). If a text is highlighted in the autocomplete list, then the command will try to remove that text. Otherwise it will try to remove text that is currently entered inside the edited object.
  *Fixed indexing issue when the popup is above the object, in which case removal threw out an error.
*Reimplemented next/prev patch window feature to make it work with newer nw.js. Should also work with older ones.
*Fixed regression with the graph_gopspill that caused first sub-GOP patch border to be drawn incorrectly.
*Added safety checks for graph_gopspill to prevent from scripting messing things up.
*Fixed visual appearance of a K12 object (raspberrypi_analog_in was erroneously instantiated with the "on" icon).
*Added dummy disis_gpio object to be used on non-RPi platforms because disis_gpio's reliance on wiringPi makes it prone to crashing when a platform is not recognized.
*Pd-l2ork main window now saves its position and size between restarts.
Add global "editable" flag. Figure out how to embed this into the patch that is not easily disabled.
  *Right click should also not work in non-editable patch. OK
  *Should be only toplevel patch? No. Any patch and by extension any subpatches. OK
  *"Select All" should not automatically enter the edit mode. OK
  *Check if text copy can still work. OK
  *Check if this properly navigates all subpatches and disables them, as well. OK
  *Deal with the alt key press and clicking on the message that disables editable option. OK
  *Rework canvas_disable_editmode_in_this_and_children_canvases to support both enabling and disabling and migrate GUI aspects to pdgui.js. OK
  *Disable put menu (see m.put.object etc. in the pd_canvas.js). MORE TESTING NEEDED
  *Add the code in pdgui to update (and keep track of) the edit menu items. MORE TESTING NEEDED
    *Use editable[cid] dictionary
    *edit, inspector, select all, find, find again, copy, paste, duplicate, cut, undo, redo, tidy
  *Add a warning in the menu as to why one cannot enable edit mode. OK
  *This may also partially address the following existing limitation:
    *cursor abstraction does not report right mouse up events due to it triggering the pop-up menu.
      *This is solved when the edit mode is not working OR by using the new disable-popup option (see below).
*Added disable-popup per-canvas option. Updated documentation for hcs/cursor and canvasinfo, and added additional documentation regarding scriptable events for canvases (referenced in the canvas-help.pd).
*Fixed issue where extra lines were added to a comment object (see pd_canvas.js line 1261 for additional info.
*Better fix for the inaccurate positioning of the Pd Console on Linux (necessary due to upstream nw.js bug). Affects Linux only.
*Cleaner (best?) approach to dealing with the Linux titlebar offset that does not require creation of a dummy window.
*Added ability to message both nwjs and pd using the "send message" option from the file menu. By prepending the message with "nwjs:", it will be sent to the nwjs side of things instead of the Pd. Also, the message now autodetects the presence of ";" at the end of it and adds it, as needed.
*Scripted resizing of patch windows keeps recreating the window and, when done fast, can result in stale windows. See 1497602807047-pd-msg/pd-msg/1.msg_and_patch/6.relocate_windows.pd. UPDATE: this is a buggy help patch that has multiple instances of the my_subpatch. Hence, it shows three windows instead of one. In addition, consistency_check is warranted because sending window height of 0 will trigger consistency check since it is an invalid window height.
*Fixed a GOP group drawing regression where an object after applying properties to an array makes array's inside contents (scalars) move with the selected object.
*Cleaned up array save contents. Enabled significantly faster saving of large amounts of audio data on Windows that may be embedded inside arrays. 3-minute file saving went from near indefinite (e.g. over an hour) to 5 seconds.
  *This is fixed, but now loading those same patches fails due to same resize limitations.
  *Capped the size on Windows up to 1,000,000 points per array. Otherwise, because Windows is currently 32-bit, upon trying to load, pd-l2ork runs out of memory.
    *Pd-L2Ork now provides a warning to a Windows user and bails.
  *Besides, saving these with the patch is woefully inefficient. One ~3-minute file balloons the patch size from a couple of KB to 150MB (!). Hence, users should be discouraged from embedding large files.
*Updated editable notifications, so that they don't redundantly spam notification for every subpatch with an array.
*Fixed a number of regressions that have resulted from the introduction of the editable option.
  *Duplicating array opens subpatch (it shouldn't). This is due to the old editable flag triggering mandatory opening of the patch that has disabled editable option. Now, it is reported only in the console.
  *After this, the original patch is treated as if it is array-only, thus making further edits impossible. This was due to erroneous seeking of the root parent patch inside canvas_set_editable function.
  *Selected array when moved dislocates array contents incorrectly. This was another side-effect of the aforesaid bug.
*Fixed a bug where toplevel array canvas and other patches that are not editable did not have the option to close window enabled.
*Array size text box inside array dialog should be wider.
*Added more verbose out of memory message.
*Fixed a segfault bug present in the new binbuf_addarray function.
*Added better way of handling saving contents of large arrays, including preventing their saving on Windows because there we are still stuck in 32-bit land, which can cause all kinds of problems. See the commit for more info.
*Upped the maximum array size on Windows to 2880000 (or 60 seconds worth of audio at 48KHz). Even at this size, each such array will take up 27MB, so clearly dynamic loading from HD should be used instead.
*Fixed implicit function compile error on non-Windows OSs.
*EXPERIMENTAL: enable enqueuing instead of outright drawing. doing so fixes major slowdown when trying to alter an array data by clicking and dragging (drawing using mouse), which results in a large queue of redundant redraws. TODO: check for regressions.
*Investigated a bug that occurred when loading a large array, array data is not stretched to the full default width of an array.
  *Appears to be dependent on the location of the GOP window, so this is clearly a bug.
    *It is affected with too large of an array. When keeping the size limited (as we do now by limiting embedding only up to 2880000 points), this has not manifested yet.
  *LATER: Consider drawing half as many points than it currently draws.
*Resizing GOP having one (or more) arrays that cumulatively have more than 200k points, should not redraw the GOP until the resize action is finished. So, instead we go with blanking the GOP contents if the GOP has more than 200k points cumulatively (e.g. 2 garrays inside a single canvas with 120k points each would result in blanking the canvas during resize, just like one garray with 200,001 point would). Arrays with less points (cumulatively) continue to be redrawn using enqueued operation.
*Resize triggers saving operation, which results in the verbose warning for large arrays. Therefore, disabled the warning, particularly now since it is not necessary anymore given that there is a hard limit on the array size.
*Redrawing array on nwjs side, while possible, is currently rather convoluted and not that useful. Doing so requires rethinking how the array is stored and then reattaching the contents and doing recalculation of the bbox, which can get really messy. Hence, the aforesaid implementation.
*Large arrays are very inefficient when redrawn due to array change using mouse click and drag. Chose to queue scalar redraws. This fixes the major slowdown with arrays. However, need to investigate for potential regressions.
  *Sprite game works OK.
*An array of improvements to the search browser, including ability to show folder contents and, by clicking on displayed folders, to show subfolders. Added a button that reinitializes the search index.
*When closing the patch, made sure that the dialog is always centered. This is a regression due to nw.js upgrade.
*Refined data dialog width to make it look better on Windows.
*Fixed windows not opening patches requested by a second instance of pd-l2ork that is not unique or does not have a nogui flag. The same also works now for double-clicking on any file while pd-l2ork is already running.
*Added ability to drag and drop .pd files onto the Pd-L2Ork console.
*Fixed the issue where some arrays were still not correctly stretched when drawn. It was the margin of error that crept in when utilizing the existing glist_xtopixel call, which includes the x offset and thus lowers the decimal accuracy of a float value. Thus, depending on the array location, the problem would manifest more or less. To test, move an array, cut it, and then undo.
*Fixed segfault when resizing red rect (due to mouse up event that should be triggered only if there is resized object).
*Fixed regression where arrays were not properly shown due to inverted y norm value.
*Added debugging messages for easier debugging.
*Fixed a series of bugs where resizing red rect in an GOP-enabled abstraction does not trigger dirty (either when done on parent or the patch itself), or does so incorrectly (e.g. on the parent canvas instead of the abstraction itself). Checked also the subpatch dirty mechanism, as well as repositioning the red rect inside the GOP-enabled subpatch or an abstraction.
*Implemented auto-updating of canvas menu at creation time, based on the editable flag.
*Fixed a bug where auto-updating did not work on OSX. TODO: check if this may cause any unwanted regressions, as well as whether we need timeout at the bottom of pd_canvas.js in update_menu_items function.
*Fixed regression with gop spill drawing on objects like K12/logic_sequencer that have GOP within GOP and where generic .gopborder query would fail identifying wrong border to be manipulated.
*Fixed offset in the array window that results in the whole array changing location downwards after a first click. On OSX and Windows, one has to move the window first to trigger setbounds call via pd_canvas.js.
*Fixed regression of queueing garray_redraws, which caused redraws to stop under certain circumstances (either too fast, e.g. 10ms, or too slow, e.g. 500ms).
*Fixed a regression where garray_doredraw explicitly re-selected scalars (elements of the array), when this is not needed anymore, since they are now a part of the group (new GOP drawing approach).
*Fixed a bug where comments had redundant borders drawn every time the user (re)entered the edit mode, which caused problems with advanced theme editing.
*As a redundant safety precaution, now that I understand the syntax, reverted the port value to +port which ensures that this is always a numerical value.
*Added 60-hz theme and added ability to customize SVG and editmode background color (large and small tiles separately) and default array colors via CSS variables. Enabled assigning of custom text color to objects, and broken objects. All of these are used by the new 60-hz theme. Also included default SVG colors inside default.css.
*Changed default OK keyboard shortcuts in dialogs to ctrl/cmd+enter/return, as leaving it as only enter, can crash nwjs if the user's focus was on a dropdown (a.k.a. select) object, which triggers request to render a dropdown at the same time that the window is being closed.
*Implemented deterministic redrawing of the array despite using the queuegui mechanism which vastly lowers the CPU footprint of drawing arrays.
*Refinements to the disconnect command on netserver.
*Fixed bug where dropdown popup was off to the left when the screen has been scrolled to the right.
*Merge K12 menu patch and clean-up (WIP)
  *Check if patch opens ok when creating new menu with K12 mode enabled. OK
    *There is no K12 menu option in the main pd console window.
  *Fix the hide button. OK
  *Process -k12 flag correctly. OK
  *Horizontal break is too thick. OK
  *Improve width. OK
  *Hide help menu in K12 mode. OK
  *Background behind top button should be the same level of transparency as the bottom part. OK
  *Fix the scrollbar position. OK
  *Improve group button colors. OK
  *Refine menu and scrollbar spacing. Extend height to the bottom. OK
  *Right-click help is not working. OK
  *Menu is too translucent. OK
  *Put K12 menu option should be at the bottom. OK
  *Adjust K12 menu on zoom. OK
  *Extraneous triggering of update_k12_menu? OK
  *File K12 mode should be a separate item (with a break before and after). OK
  *Finish migrating K12 calls from pd_canvas.js to pdgui.js. OK
    *Need to figure out how to run menu update located in pd_canvas.js from pdgui.js... OK
  *Copy CSS stuff to other themes (:root and K12). OK
    *Make a common css that is loaded before theme which then supersedes things. Should have both of the aforesaid elements. OK
  *Should clear console be available in K12 mode? YES, but only on the main window. OK
  *Disabling K-12 mode does not revert the popup to the original one. OK
  *Dragging hscroll over K12 menu gets the hscroll grab stuck. OK
  *New window in K12 mode should be bigger since menu takes a lot of space. OK
  *Scrollbar is off now that the edit button has been removed. OK (slight margin below due to miscalculation of the svg element--a long-standing problem that currently has no explanation).
  *Toggle position is off now that the edit button has been removed. OK
  *Fix regression in file open and find (w.document should've been just document--perhaps a typo that is a result of some earlier change?) OK
  *Submenus are not transitioning/animating their height. NOT SURE IF THIS IS EVEN POSSIBLE, it is also not necessary. may revisit later.
  *K12 menu does not want to unfold when not in k12 mode. OK
  *Menu should be hidden on help files, and only unfold on new/empty patches when the edit mode is enabled using K12 mode. Similarly, hide the menu when the edit mode is off in K12 mode. OK
    *Solution, remove edit button from the k12 menu and make the tab triangle the locking icon and unfolding of the menu synonymous with the edit mode. OK
    *If K12 put menu option is enabled, it should be per-canvas option with the default being unfolded (once activated)? NO it should be exclusively driven by the editmode on/off state. OK
  *Make vscroll and hscroll grab event keep the cursor the same and afterwards revert to the appropriate cursor. OK (was problem even before the K12 menu, apparently)
  *Zoom should work even when invoked over the menu. OK
  *Keyboard shortcuts should work on top of the menu, as well. OK
*Fixed issue where relocating border (rect) of a GOP object when vis-ed due to gop_spill option, if the same object has other embedded GOP-enabled objects also with gop_spill option (e.g. K12/wii_buttons.pd and K12/logic_sequencer.pd), this would result in an error due to previous implementation selecting child GOP border, rather than that of its own.
*Merge K12 menu patch and clean-up (WIP)
  *Implement K12 demos menu option. OK
  *Make end of the hscroll/vscroll drag reflect new mouse cursor. OK
  *Separate scrolling of the k12 menu from the patch. OK
*Simplifying of the toggle_edit, gui_canvas_set_editmode, and canvas_set_editmode across pdgui.js and pd_canvas.js
*Implemented saveas on creating new K12 patch.
*Make canvas' left side wider once the K12 menu is unfolded.
*Fix the logic between show k12 menu and K12 mode.
  k12_mode_menu_status and k12_menu_status should be 0 or 1
  k12_menu should be for all patches
    no need for cid for canvas_params anymore
  entrypoints:
    set the k12_mode
    click on k12_menu_vis (ONLY IF NOT IN k12_mode)
    new window created
    toggling edit mode
  file->k12_mode
    set_k12_mode
      set the k12_mode variable
      1:
        do this on all open canvases
          update menu to reflect k12_mode
          set checkmark for the file->k12_mode
          make k12_menu visible
          editmode ? k12_menu is unfolded or not
          update_scrollbars (so that the offset is enabled or disabled depending on whether menu is unfolded or not)
      0:
        do this on all open canvases
          update all menus to reflect regular mode
          set checkmark for the file->k12_mode
          check what is the state of the k12 menu, and if:
            1:
              make sure the k12_menu is visible and if not, make it visible with -155px left offset
              editmode ? k12_menu is unfolded or not
            0:
              hide k12_menu
              make k12_menu left property -155px
          update_scrollbars (so that the offset is enabled or disabled depending on whether menu is unfolded or not)
    click on the k12_menu_vis option (ONLY IF NOT IN K12 MODE, since otherwise this option is not visible)
      toggle_k12_menu
      set the variable
      1:
        do this on all open canvases
          set checkmark for the put->k12_menu
          make k12_menu visible with left offset -155px
          editmode ? k12_menu is unfolded or not
          update_scrollbars (so that the offset is enabled or disabled depending on whether menu is unfolded or not)
      0:
        do this on all open canvases
          set checkmark for the put->k12_menu
          hide k12_menu (no need to check for K12_mode since we already know we are not in it since this option is visible)
          make k12_menu left property -155px
          update_scrollbars (so that the offset is enabled or disabled depending on whether menu is unfolded or not)
  new window created
    during menu creation, check for k12_mode (DONE, I think), BUT do not vis/unvis or set checkboxes yet
    update_menu_items (onload, after register_window_id)
    if (k12_mode || k12_menu)
      set checkmark on the file->k12_mode || put->k12_menu
      make k12_menu visible with -155px left offset
      editmode ? k12_menu is unfolded or not
      update_scrollbars (so that the offset is enabled or disabled depending on whether menu is unfolded or not)
  toggling edit mode
    send pd edit message from pd_canvas.js before we get to common stuff inside pdgui.js
    editmode ?
      1:
        if k12_mode or k12_menu_vis
          unfold the k12_menu
      0:
        if k12_mode or k_12_menu_vis
          fold the k12_menu
  *Move K12 menu to the View tab? NO, since all view options are per-canvas.
*Implement updating of the main Pd-L2Ork window menu based on K12 mode. OK
  *Instead of renaming the K12 item, just have a checkbox next to it OK
  *Make sure the K12 Demos and K12 mode elements work. OK
  *Automate addition and removal of the K12 Demos and toggling of the K12 mode and make sure that the newly created elements work. NO (see below)
    *Consider keeping K12 demos in there at all times? NEED TO since there is no graceful way I found (yet) to insert and remove items from the main app menu without breaking things...
*Update installer to include lock icon and K12 menu images in the bin folder.
  *K12-icons has lock-editmode.png, lock-runtime.png, and l2ork_addons/K12/icons-large/*
  *Given the K12 mode uses 3rd-party externals, having this now disables light builds, which is ok, since that was never our focus anyhow...
*Updated all help files in the pd/doc/5.reference/ folder to also work with the new 60-hz theme. Namely, changed font and number location for mycanvas objects that denote each inlet in the help file.
*More refinements to the help files to conform with 60-hz GUI preset.  
*Added 60-hz preset as one of the built-in ones.
*Made 60-hz preset default.
*OSX and Windows installer fixes for the new K12 mode.
*Fixed Windows path is not working for K12_demos.
*Reverted K12 icons to the old non-notched version, added K12 motor and solenoid objects and supporting images.
*Added new servo and solenoid objects to the K12 menu. Refined images and updated motor and servo abstractions.
*Refined the 60-hz theme
*Updated disis_gpio to support interfacing with servos and solenoids.
*Pressing Alt key in K12 mode does not update background.
*Fixed bug where zoom reset does not update the K12 menu size.
*Ensured that once the K12_menu offset is established, that it stays consistent (observe how it jumped after the first object is created, since at that point bbox' leftmost point has also changed to the objects' leftmost point). Note how now canvas_params has a redundant nw_win and cid arguments. I am keeping this way because this prevents two redundant calls for gui(cid).get_nw_window since some of the other calls also need nw_win. LATER: rethink this, and perhaps only pass cid instead.
*Updated K12 icons.
*Added loudspeaker output to the K12 menu.
*Added preset and comment K12 objects in a new tab.
*Fixed issue where creating an object and having k12 menun pop up (or already open with mouse being above the k12 menu), then typing, added text to the object (from the engine's perspective) but did not update the visible text inside the box.
*Made OSX menu updates consistent with the K12 mode, including the K12 Menu option.
*Added dummy disis_gpio and disis_spi objects to OSX and prepared the build of the same for Windows.
*Refined building of dummy disis_gpio and disis_spi on Windows.
*Fixed benign occasional bug where snap to grid would (due to its delayed nature) sometimes trigger canvas_get_snap_offset consistency check error due to selection being let go before the delayed action took place.
*Forgot to add updates tar_em_up.sh script for dummy gpio and spi externals for Windows and OSX.
*Bunch of additional refinements of the build process due to inclusion of the dummy gpio and spi externals.
*Added way to update default theme on Windows.
*Ensured that Windows installer installs settings system-wide, that pd-l2ork upon quitting (re)saves settings, that Windows installer now provides a custom new default theme (60-hz), that Windows uninstall does not obliterate user settings, and that Windows installer does not ask redundant questions about uninstalling older version.
*When resizing object past its minimum width, as allowed by the number of inlets or outlets (whichever is greater) and in-between spaces, its text should not get any narrower.
*Refine K12 object sizes to make images fit better.
*Fixed bug where selection box, when moving mouse over K12 menu, gets stuck and returning to the canvas keeps the selection stuck until user clicks. Similarly, now objects can be dragged below the menu, and after letting go, the canvas updates its location to make the leftmost objects visible.
*Saving dirty subpatch (abstraction) leaves parent patch still showing dirty (leaves subdirty class name on it). See wii_buttons.pd and multibuttons.pd for an example. This was due to a regression where canvas_dirtyclimb was also called from graph_vis, resulting in erroneous higher subdirties value.
*Made sure that the border coloring of GOP-enabled canvases on their parent canvases remains acurate after they are (re)opened into their own window. This includes a small dirtyclimb regression fix (checking that the canvas is not already dirty before assigning it a subdirty state).
*A quick fix to the existing themes to make them usable (by including default.css to cover anything the themes are currently not covering). LATER: refine details in areas that remain inconsistent (e.g. vanilla theme GOP selection is still orange, instead of blue).
*Fixed bug in patch_name where it did not observe the optional argument, thus being unable to pull info from parent patches.
*Refinements to the K12 objects to make them work on all platforms.
*Fixed K12 phaser abstraction to not rely on the rjlib and improved help file by adding another preset.
*Further refined the issue of creating objects dragging them with the K12 menu in the mix and starting with the mouse being over the K12 menu (now we disable the Put menu when hovering over the K12 menu).
*Cosmetic improvements to the K12 objects.
*Added missing functions to the dummy gpio object to prevent unnecessary error messages in the console.
*Fixed issue that manifests when getting the close prompt without saving the patch and after having the canvas zoomed, the scrollbars and the K12 menu do not update after zoom reset and before the close dialog appears.
*Fixed issue where fluid~ on Windows would not instantiate due to 2 'silent' dependencies by the libfluidsynth-3.dll, libgomp-1.dll and libpcre2-8-0.dll. Go figure... Added the same to the fluid~ build process (even though they have no effect there, they will trigger an error in the future if those libraries change name, so we can use this as a reminder to update Windows Makefile).
*Fixed typo in the documentation.
*Updated K12/output object to support stereo and mono-to-stereo. Updated help file and supporting icons. Ensured that the object by default is in the off position.
*On Windows make pd-l2ork default to open a filetype rather than prompting every time. WILL NOT CHANGE (if user has multiple versions of pd or other text editors that could open the .pd file, it should be up to them to set the default inside the OS).
*Made arduino abstractions available on OSX and Windows.
*Updated and cleaned-up all K12 objects and abstractions.
*Fixed issue when two-finger scrolling and afterwards pressing ctrl, the screen continues to use values to zoom in or out due to scroll inertia. Affects Windows only. The fix does not have any observable regressions on other OSs. Fixed the same for the console window.
*Window should resize to the right when the K12 menu is unfolded. OK
  *The scrollbars should also update, as needed. OK
    *Sometimes scrollbars stop updating after having used K12 menu. Open ~/Desktop/title.pd and toggle k12_menu. Looks like overflow does not get reenabled. REWORKED wheel, scroll, and canvas_params logic.
*Fix disis_gpio on RPi is not working (got a dummy instead) due to a bug (regression?) in the tar_em_up.sh script.
*Updated L2Ork Tweeter to 0.71 with regression fixes.
*Refined K12 menu scroll (using native info, rather than cooked version that is sent to the backend).
*Preferences should offer an option to clear user settings (on Windows, registry) and repopulate it with defaults.
*Moved reset_nwjs_user_settings_folder() from the dialog_prefs.html and disabled its button option on the General tab since it is such an uncommon option. Instead, started building functions that can be invoked from the File->Message that involve less common situations like this one.
  *Added reset_user_settings() function that reverts all settings to default while keeping recent files.
  *The two functions can be invoked in the File->Message prompt as:
    nwjs:reset_nwjs_user_settings_folder()
    nwjs:reset_user_settings()
*Improved preferences dialog, so that the bottom three buttons are always aligned the same, regardless the focused tab.
*Disabled right-click help for the comment object in K12 mode to prevent user from navigating into the non-K12 help documentation, since comment object is the same in both modes.
*Made arduino_connect off when using -1 option. (prior to the fix, it ran green/on on RPi for some reason, even when using -1).
*Updated nwjs to use USERPROFILE instead of HOMEPATH, so that it generates correct paths in Windows (Windows needs C:/ prefix and HOMEPATH does not supply that anymore on nw.js 0.67.1). This was preventing opening of the correct path for sessions in Tweeter, for instance.
*Initial integration of the downgraded mingw packages to make Windows version compile successful.
*Fixed regression with OSX where saved patch when reopened on OSX ended-up being smaller.




TWEETER TODO:
*Deal with sync issues when one user tries to sync with another using one of the mouse multiclick options that are invoked by clicking on the instrument/part number the user wishes to sync with.

*In offline mode, enable keyboard and other input for multiple tracks. Consider using the mouse focus by utilizing invisible ggee/image to make focus switching easier.

*When trying to load a pattern that does not exist (after having successfully loaded one that does), the main level goes to zero.




TWEETER DONE:
*L2Ork Tweeter: Enabled smooth pitch changing (detuning directly to signal generators without triggering the envelope).
*0.50 requires latest Pd-L2Ork 20211012 or newer due to new features added to the core pd-l2ork
*Fixed bug where shift+delete deleted twice
*Added hover mode ability to add notes based on the mouse (as opposed to the time bar) position. 00Made erasing using delete and shift+delete to support the hover mode. Also made insert (shift+` or ~) to support the hover mode.
*Updated and optimized the left panel to make room for the hover mode option.
*Updated server to also support the hover mode.
*Swapped tab and alt key functions to make play button easier to access.
*Added ability to disable changes to the instrument level/overdrive when changing instruments by holding the Return/Enter key. Upon releasing the Return/Enter key, the level will revert to the one associated with the new instrument.
*Included username in saving the session.
*Created a "teacher" patch that adds ability for the instructor to alter others' settings.
*Update sessions that don't have parts 11 and 12.
*Improved server-invoked load session to also include sync. Expanded server command vocabulary accordingly, adding l2ork-load-sync-delay.
*Made insert/reset/clear non-interactive (delete is manually handled using legacy code inside net-io).
*Updated Teacher widget to allow for convenient loading of sessions and sync-all.
*Fixed the bug where the toggling the sound off (by holding the "'" key) did not stick after updating an instrument via preset or via shift+up/down does not work.
*Added ability to request your client number to enable greater flexibility in supporting widgets, such as the Teacher widget.
*Further improvements to the Teacher widget, including fixing the double output by the user monitored through the teacher widget and other out-of-sync issues, refining the session load and adding the save option, preloading delay and other values, toggling the metro off after it has been on when transitioning to a user that does not have tracker on, and visually acknowledging that you cannot control your own part through the teacher widget.
*Further improvements to the audio level toggles, so that they are not affected by the remote session loading.
*Implemented synced session saving where master client sends its literal session to others, to offset for any potential latency-induced inconsistencies.
*Added ability for the Teacher widget to (re)sync based on the last loaded session.
*Bunch of small Teacher widget bug-fixes.
*Fixed obscure bug in the tracker-time logic that prevented perfect sync from happening while online.
*Refactored the session sync all highlighting logic, so that it appropriately shows up on all clients.
*Added L2OrkTweet abstraction designed for use in DISIS (L2OrkTweetDISIS.pd found in the core folder).
*Included DISIS Dante mixer widget (DISIS-Dante-Out-Controls.pd found in the admin folder) since the DISIS Dante system does not have an easy way of adjusting levels.
*Fixed a bug pertaining to session saving and the session being polluted by superfluous tracker information.
*Made session saving deterministic.
*Added a new snare drum preset, accompanying loop, and a session.
*Expanded server commands example.
*Reworked the local time-synced copying of another client, ensuring that syncing to another client (whether requested locally or remotely) is accurate.
*Made all session loading and sync requests (invoked from the Teacher widget) server secure, requiring a server password.
*Fixed a bug that prevented proper syncing when copying another client's loop with sync (shift+doubleclick or shift+tripleclick).
*Implemented filtering of the session sync request server-side to allow messages to pass only for clients that are currently connected.
*Optimized the way Teaching widget deals with session sync requests by relying on its own iteration of the coll object and ensuring that the session is not redundantly reloaded if the user is looking to sync to the same session. This implementation allows for the user to load one session to all clients and then use sync from another session. This has proved useful when working collaboratively developing a piece and saving sections as distinct sessions. In the process of developing new ideas, it is possible that clients intentionally move away from an earlier session's sync. This way the new material can be preserved (assuming it is not sync-sensitive), while reverting to an earlier session's sync.
*Cosmetic fixes to the Dante main out controls.
*Added a couple new work-in-progress sessions and two new presets.
*Reworked local copy logic, replacing original 6 options with 8, with 4 and 8 (quadruple click and shift+quadruple click) being identical (copy everything). The new addition is syncing the tracker position and loop-length only (loop-all variables). Also, made the basic/common elements require fewer clicks. See the supplemental documentation subpatcher in the top-right corner for additional info.
*Added local main out level control, located in the right corner of the top bar.
*Added sessions for the "4th Beat" work-in-progress.
*Added l2ork-conduct server message (synonymous with l2ork-teach). This now enables conductor patches to affect every aspect of every instrument remotely and synchronously.
*Enabled session sync offset to ensure that a saved session can be (re)synced at any given point in time.
*Disabled sending data to the server from the Teacher widget when using user 0 (which is treated as disabled mode).
*Reorganized patch locations. Server-Commands-Example was renamed to Conductor-Commands and moved in the admin subfolder. "Into the Abyss" work presets, loops, and score have been moved into a newly created works subfolder. This has also freed-up the creation of new presets past the preset 110.
*Added documentation on conductor control variables and added overdrive-override that can override user level toggle (e.g. using ' or return keys).
*Initialized load preset value to 11 to avoid having to cycle by default through empty presets.
*Refactored admin commands to make them easier to edit and expand. Re-tested each of the admin messages and addressed bugs for obfuscation, loading/saving error messages, proper socket detection for the password change, filtering of messages that get printed out, and disabling of ping timeout for a user who got bumped to an audience/guest status via server command.
*Improved handling of title-less sessions and announcing of user session loading when online.
*Refactored select init calls to make them easier to locate inside the L2Ork-Tweeter.pd patch.
*Added brute force disconnection when disconnection occurs to address the issue of potential stale sockets.
*Added l2ork-inst-level-at l2ork-inst-level-all-at admin commands to the Server and Tweeter client. Expanded the L2OrkTweet to accommodate new functionality.
*Updated Conductor-Commands documentation, adding new server commands.
*Added loadbang to (re)send main out levels to every instantiated L2OrkTweet.pd abstraction to prevent no volume issue.
*Reworked the overdrive-override logic to prevent some of the buggy behavior between the keyboard shortcuts and the levels sent by the server.
*Fixed a bug where inst-level-all-at and inst-level-at server messages did not work under certain circumstances.
*Added a l2ork-inst-level-list-at message that allows for levels for each instrument individually provided as a list.
*Updated Conductor-Commands.pd patch, documenting the new command.
*Updated the conductor-shortcuts.pd patch for the "4th beat" composition.
*Added supporting files for the "4th beat" composition.
*Refactored "Into the Abyss" to match the new formatting for the purpose of future automatic retrieval.
*Bug fixes reenabling Tweeter's chat admin messages and fixing the l2ork-free-slot server command.
*Fixed server bug where l2ork-sync-* messages did not get passed to the guest users.
*Updated Tweeter 4th Beat's conductor shortcuts patch.
*Cleaned up L2OrkTweet.pd abstraction to minimize redundant maintenance of the version it is associated with.
*Updated "4th Beat" score.
*Fixed a bug where a user who connects after all the slots have been taken is immediately made into a guest but whose id is erroneously set to -1, resulting in user's inability to receive select server messages.
*Fixed a server bug dealing with the sequence of disconnecting clients, simplifying the flow.
*Updated documentation in the server patch.
*Updated 4th Beat score.
*0.66 New version of L2Ork Tweeter with the L2Orkmote interface.
*Minor refinements to the L2Orkmote-Interface (part of Tweeter).
*Bug-fixes to the L2Orkmote implementation. Added missing file.
*Fixed missing session filename entry textbox after last update.
*0.67 fixed double delete bug when networked.
*Added Harmonicity and Mod Amp auto-update when using arrows up and down to change values.
*Improved wording on the description of various multi-click sync options.
*Added 6 new instrument presets.
*0.68 fixed bugs in the L2Orkmote-Interface.pd, L2OrkTweet-L2Orkmote.pd, and L2Orkmote-Tweeter.pd:
  *Loop number updates on the main window when the user is using joystick
  *Preset number updates on the main window when the user is using joystick
  *Fixed clearing of the loop not working when the joystick is centered.
  *Added dynamic ability to cycle between loops and presets by holding LH button 2.
  *Fixed a bug where preset selection button erroneously also loaded the last loop selection.
  *Transposition now works (both octaves via buttons and the fine adjustment using joystick).
  *Made joystick-based transposition microtonal.
  *Fixed a bug where dry out did not adjust using the joystick (in the appropriate mode).
*0.69:
  *Added Transatlantic Grapevine (WIP) with supporting patches.
  *Added l2ork-custom server command for customizing various aspects of the Tweeter.
  *Enabled automation on the main output multiplier slider (found in the top-right corner).
  *Added new Transatlantic Grapevine sessions.
  *Documentation fix to the Conductor-Commands.pd.
  *Code clean-up.
*0.70:
  *Implemented editable option to prevent accidental edit mode.
  *Refinements to the Grapevine patches.




HELP FILES TODO:




HELP FILES DONE:




K12:




NOTES:
*order of the execution for the new canvas creation:
gui_canvas_new has_toplevel_scalars=0
nw_create_patch_window_menus
pd_canvas.js init x55e86dd973c0 0


*order of execution for the pd start
s_main.c:   sys_main
            sys_argparse (sets sys_openlist or files to be open)
            sys_fakefromgui (if nogui flag is used)
                glob_initfromgui... (fast-forward below ---)
s_inter.c:  sys_startgui (if starting with gui)
                -->HERE WE CAN PASS FILES TO THE FRONT-END
                set_datadir (deals with sys_unique, and if it is not unique does not pass a port number, which makes nw.js not spawn a new instance)
from GUI:   "init" message calls glob_initfromgui... (fast-forward below ---)
---------------------------------
s_main.c:   glob_initfromgui CLEARS sys_openlist (and tries to open files)
                openit
s_path.c:           open_via_path

Use for starting master instance:
killall pd-l2ork || true && make && sudo cp ../bin/pd-l2ork /usr/bin/ && sudo cp ../nw/*js /usr/lib/pd-l2ork/bin/ && pd-l2ork ~/Desktop/b.pd &

Use for starting second instance:
pd-l2ork -stderr ~/Desktop/c.pd


TOOLTIPS:
    var ttt = index.search("print", {fields: {title: {}}});
    var yyy = index.documentStore.getDoc(ttt[0].ref);
    post("search result: title=" + yyy.title + " description=" + yyy.description);


Tracking place to increase bbox due to K12 menu:
g_editor.c mouseup MA_MOVE calls scrollbar_synchronous_update
g_all_guis.c scrollbar_synchronous_update calls gui_canvas_get_immediate_scroll
pdgui.js gui_canvas_get_immediate_scroll calls do_getscroll (check_geom = 0)
         do_getscroll calls canvas_params (which calculates bbox)

pd_canvas.js in nw_create_patch_window_menus toggles visibility of the K12 menu if the mode is toggled from the file menu




M1/M2 cross-compiling for Intel platform (from AG's post):
A quick note to anyone who wants to do their own Intel builds from this branch: This is done most easily if you still have an Intel Mac, but if all you have is an M1/M2 Mac, you can still cross-compile for x86_64 using Xcode and a parallel x86_64 installation of Homebrew, as explained in this blog post: https://medium.com/mkdir-awesome/how-to-install-x86-64-homebrew-packages-on-apple-m1-macbook-54ba295230f.
I have tried this method myself, and it works. In addition to what's written in the blog post, I recommend setting up a dedicated shell profile, so that the Homebrew environment is set for x86_64 compilation. Something like this should do the trick:

# Set PATH, MANPATH, etc., for Homebrew.
eval "$(/usr/local/homebrew/bin/brew shellenv)"

# readline is keg-only, make sure that its pkgconfig is found
export PKG_CONFIG_PATH="/usr/local/homebrew/Cellar/readline/8.2.1/lib/pkgconfig"

alias axbrew='arch -x86_64 /usr/local/homebrew/bin/brew'
alias ax='arch -x86_64'

You can then use axbrew to install the required packages as described in the blog post, and ax make to compile Purr Data itself. Be warned, however, that brew will have to compile many packages you install from source, since ready-made binary packages for x86_64 aren't always available for the latest arm64 versions of macOS.
